<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Cari Hewan Aneh (Hard Mode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* FRAME 16:9 - Layout Kuis TV/YouTube */
        #game-frame {
            width: 100%;
            max-width: 1280px;
            aspect-ratio: 16/9;
            background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%); /* Warna malam/hutan gelap */
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border: 8px solid #312e81;
            display: flex;
            flex-direction: column;
        }

        /* ANIMASI KONTAINER BERGOYANG */
        @keyframes swayBox {
            0% { transform: rotate(0deg) translateY(0px); }
            25% { transform: rotate(0.5deg) translateY(-2px); }
            50% { transform: rotate(0deg) translateY(0px); }
            75% { transform: rotate(-0.5deg) translateY(2px); }
            100% { transform: rotate(0deg) translateY(0px); }
        }

        .container-dynamic {
            animation: swayBox 8s ease-in-out infinite;
            transform-origin: center center;
        }

        /* ANIMASI POP-IN (GRID ITEMS) */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .anim-pop { animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

        /* ANIMASI REVEAL (JAWABAN BENAR) */
        @keyframes jedagJedug {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); border-color: rgba(239, 68, 68, 0.8); }
            50% { transform: scale(1.2); box-shadow: 0 0 20px 10px rgba(239, 68, 68, 0); border-color: rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); border-color: rgba(239, 68, 68, 0.8); }
        }

        .reveal-odd {
            border: 4px solid #ef4444 !important; /* Merah */
            border-radius: 50%;
            animation: jedagJedug 0.8s infinite !important;
            z-index: 50;
            background-color: white !important;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.8);
        }

        /* CSS VARIATIONS (SHAPE/COLOR) */
        .emoji-span {
            display: inline-block;
            transition: transform 0.3s;
            position: relative;
            z-index: 10;
        }

        /* VARIASI MODE SULIT */
        .variant-tilt-hard { transform: rotate(30deg); }
        .variant-scale-hard { transform: scale(0.65); }
        .variant-skew-hard { transform: skew(-20deg); }
        .variant-pale-hard { filter: saturate(0.4) opacity(0.85); }
        .variant-bright-hard { filter: brightness(1.4); }

        /* PAW OVERLAYS (Sistem Jejak Kaki - Pengganti Daun) */
        .paw-extra {
            position: absolute;
            font-size: 0.6em;
            pointer-events: none;
            filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.3));
            z-index: 20;
            opacity: 0.8;
        }
        
        .paw-pos-1 { top: -5px; right: -10px; transform: rotate(15deg); }
        .paw-pos-2 { top: -5px; left: -10px; transform: rotate(-45deg); }

        /* ANIMASI BACKGROUND MELAYANG */
        @keyframes floatUp {
            0% { transform: translateY(120%) rotate(0deg); opacity: 0; }
            10% { opacity: 0.15; }
            90% { opacity: 0.15; }
            100% { transform: translateY(-120%) rotate(360deg); opacity: 0; }
        }

        .floating-item {
            position: absolute;
            bottom: -50px;
            animation: floatUp linear infinite;
            pointer-events: none;
            z-index: 0;
            filter: grayscale(30%);
            opacity: 0.1;
        }

        /* ITEM STYLING */
        .grid-item {
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            aspect-ratio: 1;
            border: 2px solid transparent;
            z-index: 10;
            position: relative;
        }
        .grid-item:hover {
            transform: scale(1.15);
            background-color: #f3f4f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .grid-item:active {
            transform: scale(0.9);
        }

        /* TIMER BAR VERTICAL */
        .timer-progress {
            transition: height 1s linear;
        }

        /* TIMER EMOJI INDICATOR */
        .timer-indicator {
            transition: bottom 1s linear;
            z-index: 20;
            left: 50%;
            transform: translate(-50%, 50%);
        }
    </style>
</head>
<body>

    <div id="game-frame">
        
        <!-- INTRO SCREEN -->
        <div id="start-screen" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-indigo-950/95 backdrop-blur-sm text-white">
            <div class="flex gap-4 mb-6 text-7xl animate-bounce">
                <span>ü¶Å</span><span>üêº</span><span>üêæ</span><span>üêØ</span>
            </div>
            <h1 class="text-6xl font-bold mb-2 uppercase tracking-wider text-green-400 drop-shadow-lg text-center" style="text-shadow: 2px 2px 0px #064e3b;">TEBAK HEWAN</h1>
            <p class="text-2xl mb-8 font-semibold text-gray-300">Cari hewan dengan ciri atau jejak kaki berbeda!</p>
            <button id="btn-start" onclick="startGame()" class="bg-green-600 hover:bg-green-500 text-white text-3xl font-bold py-4 px-12 rounded-full border-b-8 border-green-800 active:border-b-0 active:translate-y-2 transition-all shadow-xl hover:scale-105">
                MULAI TANTANGAN
            </button>
        </div>

        <!-- GAMEPLAY SCREEN -->
        <div id="game-screen" class="flex flex-col h-full w-full hidden">
            
            <!-- TOP BAR (HEADER) - TEXT REMOVED, ANIMATION ADDED -->
            <div class="relative w-full h-24 bg-black/30 backdrop-blur-md border-b border-white/10 shrink-0 overflow-hidden">
                <!-- Header Floating Animals Container -->
                <div id="header-floating-bg" class="absolute inset-0 z-0 pointer-events-none w-full h-full"></div>
            </div>

            <!-- MAIN CONTENT -->
            <div class="flex-1 w-full flex flex-row items-stretch justify-center p-6 gap-6 relative max-w-6xl mx-auto">
                
                <!-- White Container (HEWAN) -->
                <div class="flex-1 bg-white rounded-[2rem] p-4 shadow-[0_20px_40px_-10px_rgba(0,0,0,0.6)] border-8 border-white/20 relative z-10 flex items-center justify-center overflow-hidden container-dynamic">
                    
                    <!-- Background Floating Animals Container -->
                    <div id="floating-bg" class="absolute inset-0 z-0 pointer-events-none w-full h-full"></div>

                    <!-- The Grid Container -->
                    <div id="emoji-grid" class="grid grid-cols-10 gap-1 md:gap-3 w-full relative z-10">
                        <!-- Items generated by JS -->
                    </div>

                </div>

                <!-- Timer Bar (VERTICAL - Kanan) -->
                <div class="w-20 relative flex flex-col items-center">
                    <!-- Container Bar -->
                    <div class="w-full h-full bg-gray-900/50 rounded-full border-4 border-white/30 shadow-[0_0_20px_rgba(0,0,0,0.4)] relative overflow-visible">
                        
                        <!-- Inner Container (Clipped Progress Bar) -->
                        <div class="absolute bottom-0 left-0 w-full h-full rounded-full overflow-hidden">
                            <div id="timer-bar" class="timer-progress absolute bottom-0 left-0 w-full bg-gradient-to-t from-green-400 via-yellow-400 to-red-500 shadow-[inset_0_2px_10px_rgba(255,255,255,0.3)]" style="height: 100%;"></div>
                        </div>

                        <!-- Emoji Indicator -->
                        <div id="timer-indicator" class="timer-indicator absolute text-5xl filter drop-shadow-lg" style="bottom: 100%;">
                            ü¶Å
                        </div>

                    </div>
                </div>

                <!-- Feedback Overlay -->
                <div id="feedback-overlay" class="hidden absolute inset-0 z-30 flex items-center justify-center bg-black/60 backdrop-blur-sm rounded-[2rem]">
                    <div class="text-center">
                        <div id="feedback-text" class="text-8xl font-bold text-white uppercase drop-shadow-[0_10px_10px_rgba(0,0,0,0.8)] animate-bounce text-center leading-tight">
                            KETEMU!
                        </div>
                        <!-- Subtext Motivation -->
                        <div id="feedback-subtext" class="text-3xl font-semibold text-yellow-300 mt-6 drop-shadow-md animate-pulse">
                            <!-- Text disuntikkan via JS -->
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-screen" class="hidden absolute inset-0 z-50 flex flex-col items-center justify-center bg-purple-900 text-white">
            <div class="bg-white/10 p-12 rounded-3xl backdrop-blur-md border border-white/20 text-center shadow-2xl max-w-2xl w-full animate-pop">
                <div class="text-yellow-400 text-8xl mb-4">üèÜ</div>
                <h2 class="text-5xl font-bold mb-2">HASIL AKHIR</h2>
                <p class="text-xl text-purple-200 mb-8">Petualangan selesai!</p>
                
                <div class="bg-purple-800 p-8 rounded-2xl border-b-8 border-purple-950 mb-8">
                    <div class="text-purple-300 text-lg uppercase font-bold tracking-widest mb-2">Skor Akhir</div>
                    <div class="text-6xl font-bold text-white" id="final-score">0</div>
                </div>

                <button onclick="startGame()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-yellow-900 text-2xl font-bold py-4 rounded-xl border-b-8 border-yellow-700 active:border-b-0 active:translate-y-2 transition-all">
                    MAIN LAGI
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- DATA HEWAN (40 Jenis) ---
        const animalsData = [
            { name: "Anjing", icon: "üê∂" },
            { name: "Kucing", icon: "üê±" },
            { name: "Tikus", icon: "üê≠" },
            { name: "Hamster", icon: "üêπ" },
            { name: "Kelinci", icon: "üê∞" },
            { name: "Rubah", icon: "ü¶ä" },
            { name: "Beruang", icon: "üêª" },
            { name: "Panda", icon: "üêº" },
            { name: "Koala", icon: "üê®" },
            { name: "Harimau", icon: "üêØ" },
            { name: "Singa", icon: "ü¶Å" },
            { name: "Sapi", icon: "üêÆ" },
            { name: "Babi", icon: "üê∑" },
            { name: "Katak", icon: "üê∏" },
            { name: "Monyet", icon: "üêµ" },
            { name: "Ayam", icon: "üêî" },
            { name: "Penguin", icon: "üêß" },
            { name: "Burung", icon: "üê¶" },
            { name: "Bebek", icon: "ü¶Ü" },
            { name: "Elang", icon: "ü¶Ö" },
            { name: "Burung Hantu", icon: "ü¶â" },
            { name: "Kelelawar", icon: "ü¶á" },
            { name: "Serigala", icon: "üê∫" },
            { name: "Babi Hutan", icon: "üêó" },
            { name: "Kuda", icon: "üê¥" },
            { name: "Kuda Poni", icon: "ü¶Ñ" },
            { name: "Lebah", icon: "üêù" },
            { name: "Ulat", icon: "üêõ" },
            { name: "Kupu-kupu", icon: "ü¶ã" },
            { name: "Siput", icon: "üêå" },
            { name: "Kura-kura", icon: "üê¢" },
            { name: "Ular", icon: "üêç" },
            { name: "Kadal", icon: "ü¶é" },
            { name: "Buaya", icon: "üêä" },
            { name: "Paus", icon: "üê≥" },
            { name: "Lumba-lumba", icon: "üê¨" },
            { name: "Ikan", icon: "üêü" },
            { name: "Gurita", icon: "üêô" },
            { name: "Kepiting", icon: "ü¶Ä" },
            { name: "Udang", icon: "ü¶ê" }
        ];

        // --- AUDIO SYSTEM: SYNTH & VOICE ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        
        try {
            audioCtx = new AudioContext();
        } catch (e) {
            console.warn("Web Audio API tidak didukung browser ini.");
        }
        
        // 1. SOUND EFFECTS (Tick Sound)
        function playTickSound(timeLeft) {
            if (!audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume().catch(e => console.log(e));

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const pitch = 600 + ((10 - timeLeft) * 100); 
            const volume = 0.1 + ((10 - timeLeft) * 0.04);

            osc.type = 'triangle';
            osc.frequency.setValueAtTime(pitch, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // SOUND EFFECT (Success Ding!)
        function playSuccessSound() {
            if (!audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume().catch(e => console.log(e));
            
            // Nada 1
            const osc1 = audioCtx.createOscillator();
            const gain1 = audioCtx.createGain();
            osc1.connect(gain1);
            gain1.connect(audioCtx.destination);
            osc1.type = 'sine';
            osc1.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            gain1.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain1.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
            osc1.start();
            osc1.stop(audioCtx.currentTime + 0.5);

            // Nada 2 (Harmoni)
            setTimeout(() => {
                if (!audioCtx) return;
                const osc2 = audioCtx.createOscillator();
                const gain2 = audioCtx.createGain();
                osc2.connect(gain2);
                gain2.connect(audioCtx.destination);
                osc2.type = 'sine';
                osc2.frequency.setValueAtTime(1046.50, audioCtx.currentTime); // C6
                gain2.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.6);
                osc2.start();
                osc2.stop(audioCtx.currentTime + 0.6);
            }, 100);
        }

        // 2. VOICE HOST (Lively & Dynamic)
        const host = window.speechSynthesis;
        let hostVoice = null;

        function initVoice() {
            if (!host) return;
            const voices = host.getVoices();
            hostVoice = voices.find(v => v.lang.includes('id')) || voices[0];
        }
        
        if (host && host.onvoiceschanged !== undefined) {
            host.onvoiceschanged = initVoice;
        }

        function speak(text, type = 'normal') {
            if (!host) return;
            if (!hostVoice) initVoice();
            host.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            if (hostVoice) utterance.voice = hostVoice;
            utterance.lang = 'id-ID';

            const randomRate = 1.0 + (Math.random() * 0.3);
            const randomPitch = 0.9 + (Math.random() * 0.4);

            utterance.rate = randomRate;
            utterance.pitch = randomPitch;

            if (type === 'excited') {
                utterance.rate = 1.2 + (Math.random() * 0.2); 
                utterance.pitch = 1.2 + (Math.random() * 0.3); 
            } else if (type === 'sad') {
                utterance.rate = 0.8 + (Math.random() * 0.2); 
                utterance.pitch = 0.7 + (Math.random() * 0.2); 
            }

            host.speak(utterance);
        }

        // --- KAMUS KATA ---
        const phrases = {
            correct: [
                "Mantap jiwa!", "Mata elang!", "Keren abis!", "Luar biasa!", 
                "Tepat sekali!", "Jagoan!", "Gokil!", "Savage!", 
                "Gaspol!", "Wah, ga ada obat!", "Hebat sekali!", 
                "Sempurna!", "Gampang kan?"
            ],
            wrong: [
                "Aduh, salah!", "Coba lagi!", "Meleset bos!", "Yah, kurang tepat!", 
                "Hati-hati!", "Waduh!", "Belum beruntung!", "Jangan nyerah!", 
                "Aduh, beda tipis!", "Fokus, fokus!", "Bukan yang itu!"
            ],
            intro: [
                "Siap-siap ya!", "Ayo mulai petualangan hewan!", "Tunjukkan taringmu!", 
                "Fokus matanya!", "Tarik napas, mulai!", "Lets go!"
            ],
            levelStart: [
                "Cari...", "Temukan...", "Mana nih...", "Ayo cari...", "Target kita...", "Coba temukan..."
            ],
            motivation: [
                "Jangan kasih kendor, lanjut!",
                "Ayo sikat level berikutnya!",
                "Kamu on fire! Teruskan!",
                "Level depan pasti bisa!",
                "Semangat terus pantang mundur!",
                "Pertahankan rekor ini!",
                "Siap tantangan baru? Gasss!",
                "Fokus lagi, kita lanjut!"
            ]
        };

        function getRandomPhrase(type) {
            const list = phrases[type];
            return list[Math.floor(Math.random() * list.length)];
        }

        // --- VARIABLES ---
        let currentLevel = 0;
        let score = 0;
        let timer = 10;
        let timerInterval;
        let currentOddBtn = null; 
        let isRevealing = false; 

        // --- DOM ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const timerBar = document.getElementById('timer-bar');
        const timerIndicator = document.getElementById('timer-indicator');
        const emojiGrid = document.getElementById('emoji-grid');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackText = document.getElementById('feedback-text');
        const feedbackSubText = document.getElementById('feedback-subtext'); 
        const floatingBg = document.getElementById('floating-bg');
        const headerFloatingBg = document.getElementById('header-floating-bg');
        const finalScoreEl = document.getElementById('final-score');

        // --- ANIMATIONS ---
        function createFloatingItems() {
            floatingBg.innerHTML = ''; 
            const bgItems = ["üê∂", "üê±", "üê∞", "ü¶ä", "ü¶Å", "üêØ", "üêº", "üê®"];
            for (let i = 0; i < 15; i++) {
                const el = document.createElement('div');
                el.innerText = bgItems[Math.floor(Math.random() * bgItems.length)];
                el.className = 'floating-item';
                el.style.left = `${Math.random() * 95}%`; 
                el.style.fontSize = `${Math.random() * 3 + 2}rem`; 
                el.style.animationDuration = `${Math.random() * 10 + 8}s`; 
                el.style.animationDelay = `${Math.random() * 10}s`; 
                floatingBg.appendChild(el);
            }
        }

        function createHeaderFloatingItems() {
            headerFloatingBg.innerHTML = ''; 
            const bgItems = ["üê∂", "üê±", "üê∞", "ü¶ä", "ü¶Å", "üêØ", "üêº", "üê®"];
            for (let i = 0; i < 12; i++) {
                const el = document.createElement('div');
                el.innerText = bgItems[Math.floor(Math.random() * bgItems.length)];
                el.className = 'floating-item';
                el.style.left = `${Math.random() * 95}%`; 
                el.style.fontSize = `${Math.random() * 2 + 1.5}rem`; 
                el.style.animationDuration = `${Math.random() * 5 + 4}s`; 
                el.style.animationDelay = `${Math.random() * 5}s`; 
                headerFloatingBg.appendChild(el);
            }
        }

        function addPaw(parent, positionClass) {
            const paw = document.createElement('span');
            paw.innerText = "üêæ"; // Jejak Kaki sebagai varian
            paw.className = `paw-extra ${positionClass}`;
            parent.appendChild(paw);
        }

        // --- GAME LOGIC ---

        function startGame() {
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            createFloatingItems(); 
            createHeaderFloatingItems();
            
            if (audioCtx && audioCtx.state === 'suspended') {
                audioCtx.resume().catch(e => console.log(e));
            }
            
            speak("Selamat datang di Tantangan Hewan Ekstrim! " + getRandomPhrase('intro'), 'excited');

            score = 0;
            currentLevel = 1;
            loadLevel();
        }

        function loadLevel() {
            isRevealing = false;
            currentOddBtn = null;

            // Pilih hewan berurutan (looping)
            const itemIndex = (currentLevel - 1) % animalsData.length;
            const animalData = animalsData[itemIndex];
            const baseIcon = animalData.icon;
            
            // Suara Soal
            setTimeout(() => {
                const introWord = getRandomPhrase('levelStart');
                const textToSpeak = `${introWord} ${animalData.name}!`;
                
                if (currentLevel > 1) {
                    speak(textToSpeak, 'normal');
                } else {
                    setTimeout(() => speak(textToSpeak, 'normal'), 2500);
                }
            }, 500);

            if (timerIndicator) timerIndicator.innerText = baseIcon;
            
            // Randomly choose puzzle type: Visual Transform OR Paw Count
            const isPawPuzzle = Math.random() > 0.5;

            let selectedVariation = '';
            if (!isPawPuzzle) {
                const variationTypes = ['variant-tilt-hard', 'variant-scale-hard', 'variant-skew-hard', 'variant-pale-hard', 'variant-bright-hard'];
                selectedVariation = variationTypes[Math.floor(Math.random() * variationTypes.length)];
            }

            let normalPawCount = 0;
            let oddPawCount = 0;
            if (isPawPuzzle) {
                const scenario = Math.random() > 0.5 ? 1 : 2;
                if (scenario === 1) {
                    normalPawCount = 1;
                    oddPawCount = 0;
                } else {
                    normalPawCount = 2;
                    oddPawCount = 1;
                }
            }

            const totalItems = 50;
            const oddPosition = Math.floor(Math.random() * totalItems);

            emojiGrid.innerHTML = ""; 

            for (let i = 0; i < totalItems; i++) {
                const btn = document.createElement('div');
                btn.className = "grid-item text-3xl sm:text-4xl lg:text-5xl select-none flex items-center justify-center"; 
                btn.style.animationDelay = `${i * 0.005}s`;
                btn.classList.add('anim-pop');

                const span = document.createElement('span');
                span.innerText = baseIcon;
                span.className = "emoji-span"; 

                if (i === oddPosition) {
                    btn.onclick = () => handleAnswer(true);
                    currentOddBtn = btn;
                    
                    if (isPawPuzzle) {
                        if (oddPawCount >= 1) addPaw(span, 'paw-pos-1');
                        if (oddPawCount >= 2) addPaw(span, 'paw-pos-2');
                    } else {
                        span.classList.add(selectedVariation);
                    }

                } else {
                    btn.onclick = () => handleAnswer(false);
                    
                    if (isPawPuzzle) {
                        if (normalPawCount >= 1) addPaw(span, 'paw-pos-1');
                        if (normalPawCount >= 2) addPaw(span, 'paw-pos-2');
                    }
                }

                btn.appendChild(span);
                emojiGrid.appendChild(btn);
            }

            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timer = 10;
            updateTimerUI();
            
            timerInterval = setInterval(() => {
                timer--;
                playTickSound(timer);
                
                updateTimerUI();
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    revealAnswer(); 
                }
            }, 1000);
        }

        function revealAnswer() {
            isRevealing = true;
            if (currentOddBtn) {
                currentOddBtn.classList.add('reveal-odd');
            }
            setTimeout(() => {
                currentLevel++;
                loadLevel();
            }, 2000);
        }

        function updateTimerUI() {
            const pct = (timer / 10) * 100;
            timerBar.style.height = pct + "%";
            timerIndicator.style.bottom = pct + "%";
            timerBar.className = "timer-progress absolute bottom-0 left-0 w-full bg-gradient-to-t shadow-[inset_0_2px_10px_rgba(255,255,255,0.3)]";
            
            if (timer > 6) {
                timerBar.classList.add('from-green-400', 'to-green-600');
            } else if (timer > 3) {
                timerBar.classList.add('from-yellow-400', 'to-orange-500');
            } else {
                timerBar.classList.add('from-red-500', 'to-red-700');
            }
        }

        function handleAnswer(isCorrect) {
            if (isRevealing) return; 

            if (!isCorrect) {
                clearInterval(timerInterval);
                showFeedback(false, "SALAH! ‚ùå");
                speak(getRandomPhrase('wrong'), 'sad');
                return;
            }

            clearInterval(timerInterval);
            
            playSuccessSound();

            const praise = getRandomPhrase('correct');
            const motivation = getRandomPhrase('motivation');
            
            showFeedback(true, "KETEMU! üéâ", motivation);
            
            setTimeout(() => {
                speak(`${praise} ${motivation}`, 'excited');
            }, 300);
        }

        function showFeedback(isCorrect, mainText = "", subText = "") {
            feedbackOverlay.classList.remove('hidden');
            
            feedbackText.innerText = mainText;
            
            if (isCorrect) {
                feedbackText.className = "text-6xl md:text-8xl font-bold text-green-400 drop-shadow-[0_5px_5px_rgba(0,0,0,1)] animate-bounce text-center";
                if(feedbackSubText) {
                    feedbackSubText.innerText = subText;
                    feedbackSubText.classList.remove('hidden');
                }
                score += 100 + (timer * 10);
            } else {
                feedbackText.className = "text-6xl md:text-8xl font-bold text-red-500 drop-shadow-[0_5px_5px_rgba(0,0,0,1)] animate-pulse text-center";
                if(feedbackSubText) feedbackSubText.classList.add('hidden'); 
            }
            
            if(finalScoreEl) finalScoreEl.innerText = score;

            setTimeout(() => {
                feedbackOverlay.classList.add('hidden');
                currentLevel++;
                loadLevel();
            }, 3500); 
        }

        // GLOBAL EXPOSURE FOR HTML BUTTON (Fixes ReferenceError)
        window.startGame = startGame;

    </script>
</body>
</html>
